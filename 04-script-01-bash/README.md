### Как сдавать задания

Привет! 

Вы уже изучили блок «Системы управления версиями», и начиная с этого занятия все ваши работы будут приниматься ссылками на .md-файлы.

---


# Домашнее задание к занятию "4.1. Командная оболочка Bash: Практические навыки"

## Обязательные задания

1. Есть скрипт:
	```bash
	a=1
	b=2
	c=a+b
	d=$a+$b
	e=$(($a+$b))
	```
	* Какие значения переменным c,d,e будут присвоены?
	* Почему?
#### Ответ:

c = a+b, потому что для bash выражение a+b это просто строка, так как не указано, что a и b - переменные.

d = 1+2, так как переменные bash видит и осуществляет их подстановку, но выражение без скобок распознается как просто строка.

e = 3, так как тут выражение в скобках, произведена математическая операция сложения и результат записан в перененную 'e'.
	
Листинг прилагаю:
```bash
vagrant@vagrant:~$ cat 1.sh
a=1
b=2
c=a+b
d=$a+$b
e=$(($a+$b))
echo "c=$c, d=$d, e=$e"
vagrant@vagrant:~$ ./1.sh
c=a+b, d=1+2, e=3
vagrant@vagrant:~$
```

2. На нашем локальном сервере упал сервис и мы написали скрипт, который постоянно проверяет его доступность, записывая дату проверок до тех пор, пока сервис не станет доступным. В скрипте допущена ошибка, из-за которой выполнение не может завершиться, при этом место на Жёстком Диске постоянно уменьшается. Что необходимо сделать, чтобы его исправить:
	```bash
	while ((1==1)
	do
	curl https://localhost:4757
	if (($? != 0))
	then
	date >> curl.log
	fi
	done
	```
#### Ответ:

Необходимо в строке с циклом while добавить закрывающую скобку в выражение ((1=1), чтобы результат был ((1==1)) после этого скрипт сработает

3. Необходимо написать скрипт, который проверяет доступность трёх IP: 192.168.0.1, 173.194.222.113, 87.250.250.242 по 80 порту и записывает результат в файл log. Проверять доступность необходимо пять раз для каждого узла.

```bash
#!/bin/bash
arr_of_hosts=($(cat ./hosts))
#добавил загрузку из файла hosts, чтобы можно было добавлять хосты без правки кода
#если требуется статическое объявление массива хостов из кода - закоментить строку #2 и раскомментить следующую
#arr_of_hosts=("192.168.0.1" "173.194.222.113" "87.250.250.242")
for x in ${arr_of_hosts[@]}
do
 i=0
     while  (("$i" <= 4))
      do
       nc -z -w 1 $x 80
       if    (($?==0)) ;then
        echo "$(date "+%d-%m-%Y %H:%M:%S") Service is working!" >> log.log
        else echo "$(date "+%d-%m-%Y %H:%M:%S") Serive is down" >> log.log
       fi
       i=$(($i+1))
      done
done
```

Также, добавляю вывод файла hosts
```bash
vagrant@vagrant:~$ cat hosts
192.168.0.1
173.194.222.113
87.250.250.242
```


4. Необходимо дописать скрипт из предыдущего задания так, чтобы он выполнялся до тех пор, пока один из узлов не окажется недоступным. Если любой из узлов недоступен - IP этого узла пишется в файл error, скрипт прерывается
```bash
#!/bin/bash
arr_of_hosts=($(cat ./hosts))
#добавил загрузку из файла hosts, чтобы можно было добавлять хосты без правки кода
#если требуется статическое объявление массива хостов из кода - закоментить строку #2 и раскомментить следующую
#arr_of_hosts=("192.168.0.1" "173.194.222.113" "87.250.250.242")
for x in ${arr_of_hosts[@]}
do
 i=0
     while  (("$i" <= 4))
      do
       nc -z -w 1 $x 80
       if    (($?==1)) ;then
        echo "$(date "+%d-%m-%Y %H:%M:%S") Service is down! Script is down!" >> error.log && exit
        else echo "$(date "+%d-%m-%Y %H:%M:%S") Service is working!" >> log.log
       fi
       i=$(($i+1))
      done
done
```
Не очень понятно, что подразумевается под фразой "пока один из узлов окажется недоступным". На доступность, согласно предыдущему заданию, мы проверяем сервис, а не сам хост. Если так - решение верное. Опять таки, если проверять по icmp хост на доступность - на хосте может например на входе дропаться icmp, или по пути например, на fw, соответственно, корректно было бы проверять сам сервис, как я и сделал.
Есть еще для меня спорный момент в формулировке - "выполнялся до тех пор, пока один из ущлов не окажется недоступным" - т.е по прежнему по 5 пакетов на хост или ВООБЩЕ бесконечно, до тех пор пока порт перестанет светится?
Если бесконечно - тогда в условии цикла While будет тождество в целях постоянного выполнения. Также, немного поменял циклы местами. Если по прежнему надо 5 пакетов на проверку хоста - while  (("$i" <= 4))

```bash
#!/bin/bash
arr_of_hosts=($(cat ./hosts))
#добавил загрузку из файла hosts, чтобы можно было добавлять хосты без правки кода
#если требуется статическое объявление массива хостов из кода - закоментить строку #2 и раскомментить следующую
#arr_of_hosts=("192.168.0.1" "173.194.222.113" "87.250.250.242")
i=0
while  ((4 == 4))
 do
  for x in ${arr_of_hosts[@]}
   do
    nc -z -w 1 $x 80
       if    (($?==1)) ;then
        echo "$(date "+%d-%m-%Y %H:%M:%S") Service tcp/80 on host $x is down! Script is down!" >> error.log && exit
        else echo "$(date "+%d-%m-%Y %H:%M:%S") Service tcp/80 on host $x is up!" >> log.log
       fi
   done
       i=$(($i+1))
done
```


## Дополнительное задание (со звездочкой*) - необязательно к выполнению

Мы хотим, чтобы у нас были красивые сообщения для коммитов в репозиторий. Для этого нужно написать локальный хук для git, который будет проверять, что сообщение в коммите содержит код текущего задания в квадратных скобках и количество символов в сообщении не превышает 30. Пример сообщения: \[04-script-01-bash\] сломал хук.


